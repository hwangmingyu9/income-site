<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>수입 기록 전용 사이트 🍀</title>

<!-- ✅ 스타일 지원 가능한 xlsx-style 라이브러리 -->
<script src="https://cdn.jsdelivr.net/npm/xlsx-style@0.8.13/dist/xlsx.full.min.js"></script>

<style>
body {margin:0;font-family:Pretendard,sans-serif;background:#fdfdfd;color:#333;display:flex;flex-direction:column;align-items:center;min-height:100vh;}
header {width:100%;text-align:center;font-size:22px;font-weight:700;color:#00b894;padding:20px 0;border-bottom:1px solid #eee;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.05);cursor:pointer;}
.page {display:none;width:92%;max-width:450px;margin-top:30px;text-align:center;}
.card {width:100%;background:#fff;border-radius:14px;box-shadow:0 4px 8px rgba(0,0,0,0.08);text-align:center;padding:18px 0;font-weight:600;margin-bottom:15px;transition:all 0.2s ease;}
.card:hover{transform:translateY(-3px);} 
.card.green{background:#00b894;color:#fff;} 
.card.white{background:#fff;color:#00b894;border:1px solid #00b894;} 
.card.gray{background:#f5f5f5;color:#333;}
footer {width:100%;text-align:center;font-weight:600;font-size:16px;color:#00b894;padding:15px 0;border-top:1px solid #eee;background:#fafafa;}
.back-btn {background:none;color:#00b894;border:1px solid #00b894;padding:8px 14px;border-radius:8px;font-weight:600;margin-bottom:20px;cursor:pointer;}
.calendar {display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:20px;}
.day {border:1px solid #eee;border-radius:10px;min-height:70px;padding:6px;font-size:12px;text-align:center;background:#fff;transition:0.15s;display:flex;flex-direction:column;justify-content:center;align-items:center;}
.day:hover{border-color:#00b894;} .day.selected{border:2px solid #00b894;background:#e9fff7;}
.day .date{font-weight:600;font-size:13px;margin-bottom:3px;} 
.income{font-size:12px;color:#00b894;font-weight:600;white-space:pre-line;line-height:1.4em;}
.added{color:#ff0000;} 
input{width:92%;max-width:380px;padding:11px;border:1px solid #ccc;border-radius:12px;margin-bottom:10px;font-size:15px;text-align:center;background:#fff;transition:0.2s;}
input:focus{outline:none;border:1px solid #00b894;box-shadow:0 0 4px rgba(0,184,148,0.3);}
.history{margin-top:25px;background:#f9f9f9;border:1px solid #eee;border-radius:12px;padding:10px;max-height:180px;overflow-y:auto;box-shadow:inset 0 1px 4px rgba(0,0,0,0.05);}
.history h3{margin:0 0 10px 0;color:#00b894;font-size:15px;}
.history-item{font-size:13px;margin-bottom:8px;line-height:1.4em;border-bottom:1px dashed #ddd;padding-bottom:5px;}
</style>
</head>
<body>

<header onclick="showPage('page-home')">수입 기록 전용 사이트 🍀</header>

<!-- 홈 -->
<div class="page" id="page-home" style="display:block;">
  <img src="cloud.png" style="width:230px;margin-bottom:20px;">
  <div class="card green" onclick="showPage('page-eats')">쿠팡이츠 / 배민커넥트</div>
  <div class="card white" onclick="showPage('page-register')">새로운 수익 등록</div>
  <div class="card gray" onclick="showPage('page-excel')">월별 엑셀 다운로드</div>
</div>

<!-- 쿠팡배민 -->
<div class="page" id="page-eats">
  <button class="back-btn" onclick="showPage('page-home')">← 돌아가기</button>
  <h2>📊 쿠팡이츠 / 배민커넥트 수익</h2>
  <input id="eats" type="number" placeholder="쿠팡이츠 금액 (원)">
  <input id="baemin" type="number" placeholder="배민커넥트 금액 (원)">
  <div style="display:flex;gap:10px;justify-content:center;">
    <button class="card green" id="saveEats">등록</button>
    <button class="card white" id="deleteEats">삭제</button>
  </div>
  <div class="calendar" id="eats-calendar"></div>
  <div class="history" id="eats-history"><h3>📜 등록 히스토리</h3><div id="eatsHistoryList"></div></div>
</div>

<!-- 새로운 수익 등록 -->
<div class="page" id="page-register">
  <button class="back-btn" onclick="showPage('page-home')">← 돌아가기</button>
  <h2 style="color:#00b894;">✨ 새로운 수익 등록</h2>
  <input id="incomeAmount" type="number" placeholder="금액 (원) 💰">
  <input id="incomeReason" type="text" placeholder="원천 / 사유 🧾">
  <div class="calendar" id="income-calendar"></div>
  <div style="display:flex;gap:10px;justify-content:center;">
    <button class="card green" id="addIncome">등록</button>
    <button class="card white" id="deleteIncome">삭제</button>
  </div>
  <div class="history" id="income-history"><h3>📜 수익 등록 히스토리</h3><div id="historyList"></div></div>
</div>

<!-- 엑셀 -->
<div class="page" id="page-excel">
  <button class="back-btn" onclick="showPage('page-home')">← 돌아가기</button>
  <h2>📥 월별 엑셀 다운로드</h2>
  <div class="calendar" id="excel-calendar"></div>
  <div class="history" id="excel-history"><h3>📜 엑셀 저장 히스토리</h3><div id="excelHistoryLog">아직 저장된 기록이 없습니다.</div></div>
  <div style="display:flex;gap:10px;justify-content:center;margin-top:15px;">
    <button class="card gray" id="downloadExcel" style="flex:1;">엑셀 파일 다운로드</button>
    <button class="card white" id="deleteExcel" style="flex:1;">기존 엑셀 파일 삭제</button>
  </div>
</div>

<footer>이번 달 합계 : <span id="monthTotal">0</span>원 💰</footer>

<script>
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.style.display='none');
  document.getElementById(id).style.display='block';
}

let eatsData=[], incomeData=[], excelData=[];

function makeCalendar(id){
  const cal=document.getElementById(id);
  for(let i=1;i<=31;i++){
    const d=document.createElement('div');
    d.classList.add('day');
    d.dataset.daynum=i;
    d.innerHTML=`<div class='date'>${i}</div>`;
    d.onclick=()=>{document.querySelectorAll(`#${id} .day`).forEach(x=>x.classList.remove('selected'));d.classList.add('selected');window[id+'Sel']=d;};
    cal.appendChild(d);
  }
}
makeCalendar("eats-calendar");
makeCalendar("income-calendar");
makeCalendar("excel-calendar");

function refreshCalendars(){
  const combined={};
  eatsData.forEach(e=>{const d=e.day;combined[d]=(combined[d]||[]);combined[d].push(e.amount);});
  incomeData.forEach(e=>{const d=e.day;combined[d]=(combined[d]||[]);combined[d].push(`[추가] ${e.amount}`);});
  ["eats-calendar","income-calendar","excel-calendar"].forEach(id=>{
    document.querySelectorAll(`#${id} .day`).forEach(c=>{
      const day=c.dataset.daynum;
      if(combined[day]){
        const arr=combined[day];
        let html=`<div class='date'>${day}</div><div class='income'>`;
        html+=arr.map(v=>{
          if(typeof v==="string") return `<span class='added'>${v.replace(/\d+/,m=>Number(m).toLocaleString())}원</span>`;
          else return `${v.toLocaleString()}원`;
        }).join("<br>");
        html+="</div>";
        c.innerHTML=html;
      } else c.innerHTML=`<div class='date'>${day}</div>`;
    });
  });
  const total=Object.values(combined).flat().map(v=>parseInt(String(v).replace(/\D/g,"")||0)).reduce((a,b)=>a+b,0);
  document.getElementById("monthTotal").innerText=total.toLocaleString();

  excelData=[];
  for(let i=1;i<=31;i++){
    const day=i;
    const eats=eatsData.find(e=>e.day==i)?.eats||0;
    const bae=eatsData.find(e=>e.day==i)?.baemin||0;
    const extra=incomeData.find(e=>e.day==i)?.amount||0;
    const reason=incomeData.find(e=>e.day==i)?.reason||"";
    const totalSum=(Number(eats)+Number(bae)+Number(extra));
    if(eats || bae || extra){
      excelData.push({
        날짜:`10월 ${day}일`,
        배민커넥트: bae,
        쿠팡이츠: eats,
        "추가 수입": extra,
        "★ 수입 원천 사유": reason,
        "총 합계": totalSum
      });
    }
  }
  document.getElementById("excelHistoryLog").innerText=`💾 총 ${excelData.length}건 저장되었습니다.`;
}

// ✅ 쿠팡/배민 등록
document.getElementById("saveEats").onclick=()=>{
  const target=window["eats-calendarSel"];
  if(!target){alert("📅 날짜를 먼저 선택해주세요!");return;}
  const day=target.dataset.daynum;
  if(eatsData.some(e=>e.day==day)){alert("⚠️ 이미 등록된 날짜입니다. 삭제 후 다시 등록해주세요.");return;}
  const eats=document.getElementById("eats").value||0;
  const bae=document.getElementById("baemin").value||0;
  eatsData.push({day,eats,baemin:bae,amount:Number(eats)+Number(bae)});
  const item=document.createElement("div");
  item.classList.add("history-item");
  item.dataset.day=day;
  item.innerHTML=`📅 ${day}일 | [쿠팡이츠] ${Number(eats).toLocaleString()}원 [배민커넥트] ${Number(bae).toLocaleString()}원`;
  document.getElementById("eatsHistoryList").prepend(item);
  alert("✅ 정상적으로 등록 완료되었습니다!");
  refreshCalendars();
};

// ✅ 새로운 수익 등록
document.getElementById("addIncome").onclick=()=>{
  const target=window["income-calendarSel"];
  if(!target){alert("📅 날짜를 먼저 선택해주세요!");return;}
  const day=target.dataset.daynum;
  const amount=Number(document.getElementById("incomeAmount").value||0);
  const reason=document.getElementById("incomeReason").value||"";
  if(!amount||!reason){alert("💬 금액과 사유를 모두 입력해주세요!");return;}
  incomeData.push({day,amount,reason});
  const item=document.createElement("div");
  item.classList.add("history-item");
  item.dataset.day=day;
  item.innerText=`📅 ${day}일 | ${amount.toLocaleString()}원 (${reason})`;
  document.getElementById("historyList").prepend(item);
  alert("✅ 수익이 정상적으로 추가되었습니다!");
  refreshCalendars();
};

// ✅ 엑셀 다운로드 (스타일 포함)
document.getElementById("downloadExcel").onclick=()=>{
  if(excelData.length===0){alert("⚠️ 저장된 데이터가 없습니다. 먼저 수익을 등록해주세요!");return;}
  const ws=XLSX.utils.json_to_sheet(excelData, { header:["날짜","배민커넥트","쿠팡이츠","추가 수입","★ 수입 원천 사유","총 합계"] });
  ws['!cols']=[{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12}];
  const titleStyle={font:{name:"나눔고딕",sz:10,bold:true,color:{rgb:"FF0000"}},alignment:{horizontal:"center",vertical:"center"}};
  const bodyStyle={font:{name:"나눔고딕",sz:8,color:{rgb:"000000"}},alignment:{horizontal:"center",vertical:"center"}};
  const range=XLSX.utils.decode_range(ws['!ref']);
  for(let R=range.s.r;R<=range.e.r;++R){for(let C=range.s.c;C<=range.e.c;++C){
    const cellRef=XLSX.utils.encode_cell({r:R,c:C});if(!ws[cellRef])continue;ws[cellRef].s=(R===0)?titleStyle:bodyStyle;
  }}
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"2025년 10월");
  XLSX.writeFile(wb,"2025.10.xlsx");
  alert("💾 스타일 포함된 엑셀 파일이 저장되었습니다!");
};

// ✅ 삭제
document.getElementById("deleteEats").onclick=()=>{
  const target=window["eats-calendarSel"];
  if(!target){alert("🗓️ 삭제할 날짜를 선택해주세요!");return;}
  const day=target.dataset.daynum;
  eatsData=eatsData.filter(e=>e.day!=day);
  document.querySelectorAll(`#eatsHistoryList .history-item`).forEach(i=>{if(i.dataset.day==day)i.remove();});
  alert("🧹 정상적으로 삭제되었습니다!");
  refreshCalendars();
};
document.getElementById("deleteIncome").onclick=()=>{
  const target=window["income-calendarSel"];
  if(!target){alert("🗓️ 삭제할 날짜를 선택해주세요!");return;}
  const day=target.dataset.daynum;
  incomeData=incomeData.filter(e=>e.day!=day);
  document.querySelectorAll(`#historyList .history-item`).forEach(i=>{if(i.dataset.day==day)i.remove();});
  alert("🧹 정상적으로 삭제되었습니다!");
  refreshCalendars();
};
document.getElementById("deleteExcel").onclick=()=>{
  eatsData=[];incomeData=[];excelData=[];
  refreshCalendars();
  document.getElementById("excelHistoryLog").innerText="❌ 데이터가 초기화되었습니다.";
  alert("🧼 모든 데이터가 초기화되었습니다!");
};
</script>
</body>
</html>
