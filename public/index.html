<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìˆ˜ì… ê¸°ë¡ ì „ìš© ì‚¬ì´íŠ¸ ğŸ€</title>

<!-- âœ… ìŠ¤íƒ€ì¼ ì§€ì› ê°€ëŠ¥í•œ xlsx-style ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdn.jsdelivr.net/npm/xlsx-style@0.8.13/dist/xlsx.full.min.js"></script>

<style>
body {margin:0;font-family:Pretendard,sans-serif;background:#fdfdfd;color:#333;display:flex;flex-direction:column;align-items:center;min-height:100vh;}
header {width:100%;text-align:center;font-size:22px;font-weight:700;color:#00b894;padding:20px 0;border-bottom:1px solid #eee;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,0.05);cursor:pointer;}
.page {display:none;width:92%;max-width:450px;margin-top:30px;text-align:center;}
.card {width:100%;background:#fff;border-radius:14px;box-shadow:0 4px 8px rgba(0,0,0,0.08);text-align:center;padding:18px 0;font-weight:600;margin-bottom:15px;transition:all 0.2s ease;}
.card:hover{transform:translateY(-3px);} 
.card.green{background:#00b894;color:#fff;} 
.card.white{background:#fff;color:#00b894;border:1px solid #00b894;} 
.card.gray{background:#f5f5f5;color:#333;}
footer {width:100%;text-align:center;font-weight:600;font-size:16px;color:#00b894;padding:15px 0;border-top:1px solid #eee;background:#fafafa;}
.back-btn {background:none;color:#00b894;border:1px solid #00b894;padding:8px 14px;border-radius:8px;font-weight:600;margin-bottom:20px;cursor:pointer;}
.calendar {display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:20px;}
.day {border:1px solid #eee;border-radius:10px;min-height:70px;padding:6px;font-size:12px;text-align:center;background:#fff;transition:0.15s;display:flex;flex-direction:column;justify-content:center;align-items:center;}
.day:hover{border-color:#00b894;} .day.selected{border:2px solid #00b894;background:#e9fff7;}
.day .date{font-weight:600;font-size:13px;margin-bottom:3px;} 
.income{font-size:12px;color:#00b894;font-weight:600;white-space:pre-line;line-height:1.4em;}
.added{color:#ff0000;} 
input{width:92%;max-width:380px;padding:11px;border:1px solid #ccc;border-radius:12px;margin-bottom:10px;font-size:15px;text-align:center;background:#fff;transition:0.2s;}
input:focus{outline:none;border:1px solid #00b894;box-shadow:0 0 4px rgba(0,184,148,0.3);}
.history{margin-top:25px;background:#f9f9f9;border:1px solid #eee;border-radius:12px;padding:10px;max-height:180px;overflow-y:auto;box-shadow:inset 0 1px 4px rgba(0,0,0,0.05);}
.history h3{margin:0 0 10px 0;color:#00b894;font-size:15px;}
.history-item{font-size:13px;margin-bottom:8px;line-height:1.4em;border-bottom:1px dashed #ddd;padding-bottom:5px;}
</style>
</head>
<body>

<header onclick="showPage('page-home')">ìˆ˜ì… ê¸°ë¡ ì „ìš© ì‚¬ì´íŠ¸ ğŸ€</header>

<!-- í™ˆ -->
<div class="page" id="page-home" style="display:block;">
  <img src="cloud.png" style="width:230px;margin-bottom:20px;">
  <div class="card green" onclick="showPage('page-eats')">ì¿ íŒ¡ì´ì¸  / ë°°ë¯¼ì»¤ë„¥íŠ¸</div>
  <div class="card white" onclick="showPage('page-register')">ìƒˆë¡œìš´ ìˆ˜ìµ ë“±ë¡</div>
  <div class="card gray" onclick="showPage('page-excel')">ì›”ë³„ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</div>
</div>

<!-- ì¿ íŒ¡ë°°ë¯¼ -->
<div class="page" id="page-eats">
  <button class="back-btn" onclick="showPage('page-home')">â† ëŒì•„ê°€ê¸°</button>
  <h2>ğŸ“Š ì¿ íŒ¡ì´ì¸  / ë°°ë¯¼ì»¤ë„¥íŠ¸ ìˆ˜ìµ</h2>
  <input id="eats" type="number" placeholder="ì¿ íŒ¡ì´ì¸  ê¸ˆì•¡ (ì›)">
  <input id="baemin" type="number" placeholder="ë°°ë¯¼ì»¤ë„¥íŠ¸ ê¸ˆì•¡ (ì›)">
  <div style="display:flex;gap:10px;justify-content:center;">
    <button class="card green" id="saveEats">ë“±ë¡</button>
    <button class="card white" id="deleteEats">ì‚­ì œ</button>
  </div>
  <div class="calendar" id="eats-calendar"></div>
  <div class="history" id="eats-history"><h3>ğŸ“œ ë“±ë¡ íˆìŠ¤í† ë¦¬</h3><div id="eatsHistoryList"></div></div>
</div>

<!-- ìƒˆë¡œìš´ ìˆ˜ìµ ë“±ë¡ -->
<div class="page" id="page-register">
  <button class="back-btn" onclick="showPage('page-home')">â† ëŒì•„ê°€ê¸°</button>
  <h2 style="color:#00b894;">âœ¨ ìƒˆë¡œìš´ ìˆ˜ìµ ë“±ë¡</h2>
  <input id="incomeAmount" type="number" placeholder="ê¸ˆì•¡ (ì›) ğŸ’°">
  <input id="incomeReason" type="text" placeholder="ì›ì²œ / ì‚¬ìœ  ğŸ§¾">
  <div class="calendar" id="income-calendar"></div>
  <div style="display:flex;gap:10px;justify-content:center;">
    <button class="card green" id="addIncome">ë“±ë¡</button>
    <button class="card white" id="deleteIncome">ì‚­ì œ</button>
  </div>
  <div class="history" id="income-history"><h3>ğŸ“œ ìˆ˜ìµ ë“±ë¡ íˆìŠ¤í† ë¦¬</h3><div id="historyList"></div></div>
</div>

<!-- ì—‘ì…€ -->
<div class="page" id="page-excel">
  <button class="back-btn" onclick="showPage('page-home')">â† ëŒì•„ê°€ê¸°</button>
  <h2>ğŸ“¥ ì›”ë³„ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</h2>
  <div class="calendar" id="excel-calendar"></div>
  <div class="history" id="excel-history"><h3>ğŸ“œ ì—‘ì…€ ì €ì¥ íˆìŠ¤í† ë¦¬</h3><div id="excelHistoryLog">ì•„ì§ ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div></div>
  <div style="display:flex;gap:10px;justify-content:center;margin-top:15px;">
    <button class="card gray" id="downloadExcel" style="flex:1;">ì—‘ì…€ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
    <button class="card white" id="deleteExcel" style="flex:1;">ê¸°ì¡´ ì—‘ì…€ íŒŒì¼ ì‚­ì œ</button>
  </div>
</div>

<footer>ì´ë²ˆ ë‹¬ í•©ê³„ : <span id="monthTotal">0</span>ì› ğŸ’°</footer>

<script>
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.style.display='none');
  document.getElementById(id).style.display='block';
}

let eatsData=[], incomeData=[], excelData=[];

function makeCalendar(id){
  const cal=document.getElementById(id);
  for(let i=1;i<=31;i++){
    const d=document.createElement('div');
    d.classList.add('day');
    d.dataset.daynum=i;
    d.innerHTML=`<div class='date'>${i}</div>`;
    d.onclick=()=>{document.querySelectorAll(`#${id} .day`).forEach(x=>x.classList.remove('selected'));d.classList.add('selected');window[id+'Sel']=d;};
    cal.appendChild(d);
  }
}
makeCalendar("eats-calendar");
makeCalendar("income-calendar");
makeCalendar("excel-calendar");

function refreshCalendars(){
  const combined={};
  eatsData.forEach(e=>{const d=e.day;combined[d]=(combined[d]||[]);combined[d].push(e.amount);});
  incomeData.forEach(e=>{const d=e.day;combined[d]=(combined[d]||[]);combined[d].push(`[ì¶”ê°€] ${e.amount}`);});
  ["eats-calendar","income-calendar","excel-calendar"].forEach(id=>{
    document.querySelectorAll(`#${id} .day`).forEach(c=>{
      const day=c.dataset.daynum;
      if(combined[day]){
        const arr=combined[day];
        let html=`<div class='date'>${day}</div><div class='income'>`;
        html+=arr.map(v=>{
          if(typeof v==="string") return `<span class='added'>${v.replace(/\d+/,m=>Number(m).toLocaleString())}ì›</span>`;
          else return `${v.toLocaleString()}ì›`;
        }).join("<br>");
        html+="</div>";
        c.innerHTML=html;
      } else c.innerHTML=`<div class='date'>${day}</div>`;
    });
  });
  const total=Object.values(combined).flat().map(v=>parseInt(String(v).replace(/\D/g,"")||0)).reduce((a,b)=>a+b,0);
  document.getElementById("monthTotal").innerText=total.toLocaleString();

  excelData=[];
  for(let i=1;i<=31;i++){
    const day=i;
    const eats=eatsData.find(e=>e.day==i)?.eats||0;
    const bae=eatsData.find(e=>e.day==i)?.baemin||0;
    const extra=incomeData.find(e=>e.day==i)?.amount||0;
    const reason=incomeData.find(e=>e.day==i)?.reason||"";
    const totalSum=(Number(eats)+Number(bae)+Number(extra));
    if(eats || bae || extra){
      excelData.push({
        ë‚ ì§œ:`10ì›” ${day}ì¼`,
        ë°°ë¯¼ì»¤ë„¥íŠ¸: bae,
        ì¿ íŒ¡ì´ì¸ : eats,
        "ì¶”ê°€ ìˆ˜ì…": extra,
        "â˜… ìˆ˜ì… ì›ì²œ ì‚¬ìœ ": reason,
        "ì´ í•©ê³„": totalSum
      });
    }
  }
  document.getElementById("excelHistoryLog").innerText=`ğŸ’¾ ì´ ${excelData.length}ê±´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`;
}

// âœ… ì¿ íŒ¡/ë°°ë¯¼ ë“±ë¡
document.getElementById("saveEats").onclick=()=>{
  const target=window["eats-calendarSel"];
  if(!target){alert("ğŸ“… ë‚ ì§œë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”!");return;}
  const day=target.dataset.daynum;
  if(eatsData.some(e=>e.day==day)){alert("âš ï¸ ì´ë¯¸ ë“±ë¡ëœ ë‚ ì§œì…ë‹ˆë‹¤. ì‚­ì œ í›„ ë‹¤ì‹œ ë“±ë¡í•´ì£¼ì„¸ìš”.");return;}
  const eats=document.getElementById("eats").value||0;
  const bae=document.getElementById("baemin").value||0;
  eatsData.push({day,eats,baemin:bae,amount:Number(eats)+Number(bae)});
  const item=document.createElement("div");
  item.classList.add("history-item");
  item.dataset.day=day;
  item.innerHTML=`ğŸ“… ${day}ì¼ | [ì¿ íŒ¡ì´ì¸ ] ${Number(eats).toLocaleString()}ì› [ë°°ë¯¼ì»¤ë„¥íŠ¸] ${Number(bae).toLocaleString()}ì›`;
  document.getElementById("eatsHistoryList").prepend(item);
  alert("âœ… ì •ìƒì ìœ¼ë¡œ ë“±ë¡ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
  refreshCalendars();
};

// âœ… ìƒˆë¡œìš´ ìˆ˜ìµ ë“±ë¡
document.getElementById("addIncome").onclick=()=>{
  const target=window["income-calendarSel"];
  if(!target){alert("ğŸ“… ë‚ ì§œë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”!");return;}
  const day=target.dataset.daynum;
  const amount=Number(document.getElementById("incomeAmount").value||0);
  const reason=document.getElementById("incomeReason").value||"";
  if(!amount||!reason){alert("ğŸ’¬ ê¸ˆì•¡ê³¼ ì‚¬ìœ ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");return;}
  incomeData.push({day,amount,reason});
  const item=document.createElement("div");
  item.classList.add("history-item");
  item.dataset.day=day;
  item.innerText=`ğŸ“… ${day}ì¼ | ${amount.toLocaleString()}ì› (${reason})`;
  document.getElementById("historyList").prepend(item);
  alert("âœ… ìˆ˜ìµì´ ì •ìƒì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!");
  refreshCalendars();
};

// âœ… ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (ìŠ¤íƒ€ì¼ í¬í•¨)
document.getElementById("downloadExcel").onclick=()=>{
  if(excelData.length===0){alert("âš ï¸ ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ìˆ˜ìµì„ ë“±ë¡í•´ì£¼ì„¸ìš”!");return;}
  const ws=XLSX.utils.json_to_sheet(excelData, { header:["ë‚ ì§œ","ë°°ë¯¼ì»¤ë„¥íŠ¸","ì¿ íŒ¡ì´ì¸ ","ì¶”ê°€ ìˆ˜ì…","â˜… ìˆ˜ì… ì›ì²œ ì‚¬ìœ ","ì´ í•©ê³„"] });
  ws['!cols']=[{wch:12},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12}];
  const titleStyle={font:{name:"ë‚˜ëˆ”ê³ ë”•",sz:10,bold:true,color:{rgb:"FF0000"}},alignment:{horizontal:"center",vertical:"center"}};
  const bodyStyle={font:{name:"ë‚˜ëˆ”ê³ ë”•",sz:8,color:{rgb:"000000"}},alignment:{horizontal:"center",vertical:"center"}};
  const range=XLSX.utils.decode_range(ws['!ref']);
  for(let R=range.s.r;R<=range.e.r;++R){for(let C=range.s.c;C<=range.e.c;++C){
    const cellRef=XLSX.utils.encode_cell({r:R,c:C});if(!ws[cellRef])continue;ws[cellRef].s=(R===0)?titleStyle:bodyStyle;
  }}
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"2025ë…„ 10ì›”");
  XLSX.writeFile(wb,"2025.10.xlsx");
  alert("ğŸ’¾ ìŠ¤íƒ€ì¼ í¬í•¨ëœ ì—‘ì…€ íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
};

// âœ… ì‚­ì œ
document.getElementById("deleteEats").onclick=()=>{
  const target=window["eats-calendarSel"];
  if(!target){alert("ğŸ—“ï¸ ì‚­ì œí•  ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!");return;}
  const day=target.dataset.daynum;
  eatsData=eatsData.filter(e=>e.day!=day);
  document.querySelectorAll(`#eatsHistoryList .history-item`).forEach(i=>{if(i.dataset.day==day)i.remove();});
  alert("ğŸ§¹ ì •ìƒì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!");
  refreshCalendars();
};
document.getElementById("deleteIncome").onclick=()=>{
  const target=window["income-calendarSel"];
  if(!target){alert("ğŸ—“ï¸ ì‚­ì œí•  ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!");return;}
  const day=target.dataset.daynum;
  incomeData=incomeData.filter(e=>e.day!=day);
  document.querySelectorAll(`#historyList .history-item`).forEach(i=>{if(i.dataset.day==day)i.remove();});
  alert("ğŸ§¹ ì •ìƒì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!");
  refreshCalendars();
};
document.getElementById("deleteExcel").onclick=()=>{
  eatsData=[];incomeData=[];excelData=[];
  refreshCalendars();
  document.getElementById("excelHistoryLog").innerText="âŒ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.";
  alert("ğŸ§¼ ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!");
};
</script>
</body>
</html>
