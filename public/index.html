<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>수입 기록 전용 사이트 🍀</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
/* --- 민규 원본 디자인 그대로 --- */
body {
  margin: 0;
  font-family: Pretendard, sans-serif;
  background: #fdfdfd;
  color: #333;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}
header {
  width: 100%;
  text-align: center;
  font-size: 22px;
  font-weight: 700;
  color: #00b894;
  padding: 20px 0;
  border-bottom: 1px solid #eee;
  background: #fff;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  cursor: pointer;
}
.page {
  display: none;
  width: 92%;
  max-width: 450px;
  margin-top: 30px;
  text-align: center;
}
.card {
  width: 100%;
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
  text-align: center;
  padding: 18px 0;
  font-weight: 600;
  margin-bottom: 15px;
  transition: all 0.2s ease;
  cursor: pointer;
  user-select: none;
}
.card:hover { transform: translateY(-3px); }
.card.green { background: #00b894; color: #fff; }
.card.white { background: #fff; color: #00b894; border: 1px solid #00b894; }
.card.gray { background: #f5f5f5; color: #333; }
footer {
  width: 100%;
  text-align: center;
  font-weight: 600;
  font-size: 16px;
  color: #00b894;
  padding: 15px 0;
  border-top: 1px solid #eee;
  background: #fafafa;
}
.back-btn {
  background: none;
  color: #00b894;
  border: 1px solid #00b894;
  padding: 8px 14px;
  border-radius: 8px;
  font-weight: 600;
  margin-bottom: 20px;
  cursor: pointer;
}
.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 6px;
  margin-top: 20px;
}
.day {
  border: 1px solid #eee;
  border-radius: 10px;
  min-height: 70px;
  padding: 6px;
  font-size: 12px;
  text-align: center;
  background: #fff;
  transition: 0.15s;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}
.day:hover { border-color: #00b894; }
.day.selected { border: 2px solid #00b894; background: #e9fff7; }
.day .date { font-weight: 600; font-size: 13px; margin-bottom: 3px; }
.income { font-size: 12px; color: #00b894; font-weight: 600; white-space: pre-line; line-height: 1.4em; }
.added { color: #ff0000; }
input {
  width: 92%;
  max-width: 380px;
  padding: 11px;
  border: 1px solid #ccc;
  border-radius: 12px;
  margin-bottom: 10px;
  font-size: 15px;
  text-align: center;
  background: #fff;
  transition: 0.2s;
}
input:focus {
  outline: none;
  border: 1px solid #00b894;
  box-shadow: 0 0 4px rgba(0, 184, 148, 0.3);
}
.history {
  margin-top: 25px;
  background: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 12px;
  padding: 10px;
  max-height: 180px;
  overflow-y: auto;
  box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.05);
}
.history h3 {
  margin: 0 0 10px 0;
  color: #00b894;
  font-size: 15px;
}
.history-item {
  font-size: 13px;
  margin-bottom: 8px;
  line-height: 1.4em;
  border-bottom: 1px dashed #ddd;
  padding-bottom: 5px;
}
</style>
</head>
<body>

<header onclick="showPage('page-home')">수입 기록 전용 사이트 🍀</header>

<!-- 홈 -->
<div class="page" id="page-home" style="display:block;">
  <img src="cloud.png" style="width:230px;margin-bottom:20px;">
  <div class="card green" onclick="showPage('page-eats')">쿠팡이츠 / 배민커넥트</div>
  <div class="card white" onclick="showPage('page-register')">새로운 수익 등록</div>
  <div class="card gray" onclick="showPage('page-excel')">월별 엑셀 다운로드</div>
</div>

<!-- 쿠팡/배민 -->
<div class="page" id="page-eats">
  <button class="back-btn" onclick="showPage('page-home')">← 돌아가기</button>
  <h2>📊 쿠팡이츠 / 배민커넥트 수익</h2>
  <input id="eats" type="number" placeholder="쿠팡이츠 금액 (원)">
  <input id="baemin" type="number" placeholder="배민커넥트 금액 (원)">
  <div style="display:flex;gap:10px;justify-content:center;">
    <button class="card green" id="saveEats">등록</button>
    <button class="card white" id="deleteEats">삭제</button>
  </div>
  <div class="calendar" id="eats-calendar"></div>
  <div class="history"><h3>📜 등록 히스토리</h3><div id="eatsHistoryList"></div></div>
</div>

<!-- 새로운 수익 등록 -->
<div class="page" id="page-register">
  <button class="back-btn" onclick="showPage('page-home')">← 돌아가기</button>
  <h2 style="color:#00b894;">✨ 새로운 수익 등록</h2>
  <input id="incomeAmount" type="number" placeholder="금액 (원) 💰">
  <input id="incomeReason" type="text" placeholder="원천 / 사유 🧾">
  <div class="calendar" id="income-calendar"></div>
  <div style="display:flex;gap:10px;justify-content:center;">
    <button class="card green" id="addIncome">등록</button>
    <button class="card white" id="deleteIncome">삭제</button>
  </div>
  <div class="history"><h3>📜 수익 등록 히스토리</h3><div id="historyList"></div></div>
</div>

<!-- 엑셀 -->
<div class="page" id="page-excel">
  <button class="back-btn" onclick="showPage('page-home')">← 돌아가기</button>
  <h2>📥 월별 엑셀 다운로드</h2>
  <div class="calendar" id="excel-calendar"></div>
  <div class="history"><h3>📜 엑셀 저장 히스토리</h3><div id="excelHistoryLog">아직 저장된 기록이 없습니다.</div></div>
</div>

<footer>이번 달 합계 : <span id="monthTotal">0</span>원 💰</footer>

<!-- ✅ Firebase 연동 -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC_JssdYuI3Lq8CUJibU2ex9cPRTlJWFSw",
  authDomain: "income-site-89fcf.firebaseapp.com",
  projectId: "income-site-89fcf",
  storageBucket: "income-site-89fcf.firebasestorage.app",
  messagingSenderId: "645854803885",
  appId: "1:645854803885:web:1771b066b5b3f9e12d1324"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.style.display='none');
  document.getElementById(id).style.display='block';
}

function makeCalendar(id){
  const cal=document.getElementById(id);
  for(let i=1;i<=31;i++){
    const d=document.createElement('div');
    d.classList.add('day');
    d.dataset.daynum=i;
    d.innerHTML=`<div class='date'>${i}</div>`;
    d.onclick=()=>{document.querySelectorAll(`#${id} .day`).forEach(x=>x.classList.remove('selected'));d.classList.add('selected');window[id+'Sel']=d;};
    cal.appendChild(d);
  }
}
makeCalendar("eats-calendar");
makeCalendar("income-calendar");
makeCalendar("excel-calendar");

async function loadData(){
  const eatsSnap = await getDocs(collection(db, "eatsData"));
  eatsSnap.forEach(docSnap=>{
    const data=docSnap.data();
    addHistoryItem("eatsHistoryList",`📅 ${data.day}일 | [합계] ${data.amount.toLocaleString()}원`);
  });

  const incomeSnap = await getDocs(collection(db, "incomeData"));
  incomeSnap.forEach(docSnap=>{
    const data=docSnap.data();
    addHistoryItem("historyList",`📅 ${data.day}일 | ${data.amount.toLocaleString()}원 (${data.reason})`);
  });
}

function addHistoryItem(id,text){
  const item=document.createElement("div");
  item.classList.add("history-item");
  item.innerText=text;
  document.getElementById(id).prepend(item);
}

document.getElementById("saveEats").onclick=async()=>{
  const target=window["eats-calendarSel"];
  if(!target){alert("📅 날짜를 먼저 선택해주세요!");return;}
  const day=target.dataset.daynum;
  const eats=document.getElementById("eats").value||0;
  const bae=document.getElementById("baemin").value||0;
  const total=Number(eats)+Number(bae);
  await addDoc(collection(db,"eatsData"),{day,amount:total});
  addHistoryItem("eatsHistoryList",`📅 ${day}일 | [합계] ${total.toLocaleString()}원`);
  alert("✅ 등록 완료!");
};

document.getElementById("addIncome").onclick=async()=>{
  const target=window["income-calendarSel"];
  if(!target){alert("📅 날짜를 선택해주세요!");return;}
  const day=target.dataset.daynum;
  const amount=Number(document.getElementById("incomeAmount").value||0);
  const reason=document.getElementById("incomeReason").value||"";
  await addDoc(collection(db,"incomeData"),{day,amount,reason});
  addHistoryItem("historyList",`📅 ${day}일 | ${amount.toLocaleString()}원 (${reason})`);
  alert("✅ 추가 완료!");
};

loadData();
</script>
</body>
</html>
