<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ìˆ˜ì… ê¸°ë¡ ì „ìš© ì‚¬ì´íŠ¸ ğŸ€</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
body {
  margin: 0;
  font-family: Pretendard, sans-serif;
  background: #fdfdfd;
  color: #333;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}
header {
  width: 100%;
  text-align: center;
  font-size: 22px;
  font-weight: 700;
  color: #00b894;
  padding: 20px 0;
  border-bottom: 1px solid #eee;
  background: #fff;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  cursor: pointer;
}
.page {
  display: none;
  width: 92%;
  max-width: 450px;
  margin-top: 30px;
  text-align: center;
}
.card {
  width: 100%;
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
  text-align: center;
  padding: 18px 0;
  font-weight: 600;
  margin-bottom: 15px;
  transition: all 0.2s ease;
  cursor: pointer;
}
.card:hover { transform: translateY(-3px); }
.card.green { background: #00b894; color: #fff; }
.card.white { background: #fff; color: #00b894; border: 1px solid #00b894; }
.card.gray { background: #f5f5f5; color: #333; }
.back-btn {
  background: none;
  color: #00b894;
  border: 1px solid #00b894;
  padding: 8px 14px;
  border-radius: 8px;
  font-weight: 600;
  margin-bottom: 20px;
  cursor: pointer;
}
.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 6px;
  margin-top: 15px;
}
.day {
  border: 1px solid #eee;
  border-radius: 10px;
  min-height: 70px;
  padding: 6px;
  font-size: 12px;
  text-align: center;
  background: #fff;
  transition: 0.15s;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}
.day:hover { border-color: #00b894; }
.day.selected { border: 2px solid #00b894; background: #e9fff7; }
footer {
  width: 100%;
  text-align: center;
  font-weight: 600;
  font-size: 16px;
  color: #00b894;
  padding: 15px 0;
  border-top: 1px solid #eee;
  background: #fafafa;
}
</style>
</head>

<body>
<header onclick="showPage('page-home')">ìˆ˜ì… ê¸°ë¡ ì „ìš© ì‚¬ì´íŠ¸ ğŸ€</header>

<!-- í™ˆ -->
<div class="page" id="page-home" style="display:block;">
  <img src="cloud.png" style="width:230px;margin-bottom:20px;">
  <div class="card green" onclick="showPage('page-eats')">ì¿ íŒ¡ì´ì¸  / ë°°ë¯¼ì»¤ë„¥íŠ¸</div>
  <div class="card white" onclick="showPage('page-register')">ìƒˆë¡œìš´ ìˆ˜ìµ ë“±ë¡</div>
  <div class="card gray" onclick="showPage('page-expense')">ì§€ì¶œ ì¼ì • ê´€ë¦¬</div>
  <div class="card gray" onclick="showPage('page-excel')">ì›”ë³„ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</div>
</div>

<!-- ì¿ íŒ¡/ë°°ë¯¼ -->
<div class="page" id="page-eats">
  <button class="back-btn" onclick="showPage('page-home')">â† ëŒì•„ê°€ê¸°</button>
  <h2>ğŸ“Š ì¿ íŒ¡ì´ì¸  / ë°°ë¯¼ì»¤ë„¥íŠ¸</h2>
  <div class="calendar" id="eats-calendar"></div>
</div>

<!-- ìˆ˜ìµ ë“±ë¡ -->
<div class="page" id="page-register">
  <button class="back-btn" onclick="showPage('page-home')">â† ëŒì•„ê°€ê¸°</button>
  <h2 style="color:#00b894;">âœ¨ ìƒˆë¡œìš´ ìˆ˜ìµ ë“±ë¡</h2>
  <div class="calendar" id="income-calendar"></div>
</div>

<!-- ì§€ì¶œ ì¼ì • -->
<div class="page" id="page-expense">
  <button class="back-btn" onclick="showPage('page-home')">â† ëŒì•„ê°€ê¸°</button>
  <h2 style="color:#ff7675;">ğŸ’¸ ì§€ì¶œ ì¼ì • ê´€ë¦¬</h2>
  <input id="expenseReason" placeholder="ì§€ì¶œ í•­ëª© ì…ë ¥ ğŸ’¬">
  <input id="expenseAmount" type="number" placeholder="ê¸ˆì•¡ ì…ë ¥ (ì›)">
  <div class="calendar" id="expense-calendar"></div>
  <button class="card green" id="saveExpense">ë“±ë¡</button>
  <button class="card white" id="deleteExpense">ì„ íƒ ì‚­ì œ</button>
  <div id="expense-list"></div>
</div>

<!-- ì—‘ì…€ -->
<div class="page" id="page-excel">
  <button class="back-btn" onclick="showPage('page-home')">â† ëŒì•„ê°€ê¸°</button>
  <h2>ğŸ“¥ ì›”ë³„ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</h2>
  <div class="calendar" id="excel-calendar"></div>
</div>

<footer>ğŸ’š Firebase ë°ì´í„° ì €ì¥ í™œì„±í™”ë¨</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC_JssdYuI3Lq8CUJibU2ex9cPRTlJWFSw",
    authDomain: "income-site-89fcf.firebaseapp.com",
    projectId: "income-site-89fcf",
    storageBucket: "income-site-89fcf.firebasestorage.app",
    messagingSenderId: "645854803885",
    appId: "1:645854803885:web:1771b066b5b3f9e12d1324"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  function showPage(id){
    document.querySelectorAll('.page').forEach(p=>p.style.display='none');
    document.getElementById(id).style.display='block';
    window.scrollTo({ top: 0 });
  }

  function makeCalendar(id){
    const cal=document.getElementById(id);
    const now=new Date();
    const year=now.getFullYear();
    const month=now.getMonth();
    const days=new Date(year,month+1,0).getDate();
    cal.innerHTML='';
    for(let i=1;i<=days;i++){
      const d=document.createElement('div');
      d.classList.add('day');
      d.dataset.day=i;
      d.innerHTML=`<div class='date'>${i}</div>`;
      d.onclick=()=>{document.querySelectorAll(`#${id} .day`).forEach(x=>x.classList.remove('selected'));d.classList.add('selected');window[id+'Sel']=d;};
      cal.appendChild(d);
    }
  }

  makeCalendar("eats-calendar");
  makeCalendar("income-calendar");
  makeCalendar("expense-calendar");
  makeCalendar("excel-calendar");

  // âœ… ì§€ì¶œ ë“±ë¡
  document.getElementById("saveExpense").onclick=async()=>{
    const target=window["expense-calendarSel"];
    if(!target) return alert("ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”!");
    const day=target.dataset.day;
    const amount=document.getElementById("expenseAmount").value;
    const reason=document.getElementById("expenseReason").value;
    if(!amount||!reason) return alert("í•­ëª©ê³¼ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”!");
    await addDoc(collection(db,"expenses"),{day,amount,reason,ts:Date.now()});
    alert("âœ… ì§€ì¶œ ë“±ë¡ ì™„ë£Œ!");
  };

  // âœ… ì§€ì¶œ ì‚­ì œ
  document.getElementById("deleteExpense").onclick=async()=>{
    const target=window["expense-calendarSel"];
    if(!target) return alert("ì‚­ì œí•  ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”!");
    const snap=await getDocs(collection(db,"expenses"));
    snap.forEach(async(docSnap)=>{
      if(docSnap.data().day===target.dataset.day){
        await deleteDoc(doc(db,"expenses",docSnap.id));
      }
    });
    alert("ğŸ§¹ í•´ë‹¹ ë‚ ì§œ ì§€ì¶œ ì‚­ì œ ì™„ë£Œ!");
  };
</script>
</body>
</html>
