<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ìˆ˜ì… ê¸°ë¡ ì „ìš© ì‚¬ì´íŠ¸ ğŸ€</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
body {
  margin: 0;
  font-family: Pretendard, sans-serif;
  background: #fdfdfd;
  color: #333;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}
header {
  width: 100%;
  text-align: center;
  font-size: 22px;
  font-weight: 700;
  color: #00b894;
  padding: 20px 0;
  border-bottom: 1px solid #eee;
  background: #fff;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  position: relative;
  z-index: 1;
  cursor: pointer;
}
img {
  pointer-events: none;
}
.page {
  display: none;
  width: 92%;
  max-width: 450px;
  margin-top: 30px;
  text-align: center;
}
.card {
  width: 100%;
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
  text-align: center;
  padding: 18px 0;
  font-weight: 600;
  margin-bottom: 15px;
  transition: all 0.2s ease;
  cursor: pointer;
  user-select: none;
}
.card:hover { transform: translateY(-3px); }
.card.green { background: #00b894; color: #fff; }
.card.white { background: #fff; color: #00b894; border: 1px solid #00b894; }
.card.gray { background: #f5f5f5; color: #333; }
footer {
  width: 100%;
  text-align: center;
  font-weight: 600;
  font-size: 16px;
  color: #00b894;
  padding: 15px 0;
  border-top: 1px solid #eee;
  background: #fafafa;
}
.back-btn {
  background: none;
  color: #00b894;
  border: 1px solid #00b894;
  padding: 8px 14px;
  border-radius: 8px;
  font-weight: 600;
  margin-bottom: 20px;
  cursor: pointer;
}
.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 6px;
  margin-top: 20px;
}
.day {
  border: 1px solid #eee;
  border-radius: 10px;
  min-height: 70px;
  padding: 6px;
  font-size: 12px;
  text-align: center;
  background: #fff;
  transition: 0.15s;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}
.day:hover { border-color: #00b894; }
.day.selected { border: 2px solid #00b894; background: #e9fff7; }
.day .date { font-weight: 600; font-size: 13px; margin-bottom: 3px; }
.income { font-size: 12px; color: #00b894; font-weight: 600; white-space: pre-line; line-height: 1.4em; }
.added { color: #ff0000; }
input {
  width: 92%;
  max-width: 380px;
  padding: 11px;
  border: 1px solid #ccc;
  border-radius: 12px;
  margin-bottom: 10px;
  font-size: 15px;
  text-align: center;
  background: #fff;
  transition: 0.2s;
}
input:focus {
  outline: none;
  border: 1px solid #00b894;
  box-shadow: 0 0 4px rgba(0, 184, 148, 0.3);
}
.history {
  margin-top: 25px;
  background: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 12px;
  padding: 10px;
  max-height: 180px;
  overflow-y: auto;
  box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.05);
}
.history h3 {
  margin: 0 0 10px 0;
  color: #00b894;
  font-size: 15px;
}
.history-item {
  font-size: 13px;
  margin-bottom: 8px;
  line-height: 1.4em;
  border-bottom: 1px dashed #ddd;
  padding-bottom: 5px;
}
</style>
</head>
<body>

<header onclick="showPage('page-home')">ìˆ˜ì… ê¸°ë¡ ì „ìš© ì‚¬ì´íŠ¸ ğŸ€</header>

<!-- í™ˆ -->
<div class="page" id="page-home" style="display:block;">
  <img src="cloud.png" style="width:230px;margin-bottom:20px;">
  <div class="card green" role="button" onclick="showPage('page-eats')">ì¿ íŒ¡ì´ì¸  / ë°°ë¯¼ì»¤ë„¥íŠ¸</div>
  <div class="card white" role="button" onclick="showPage('page-register')">ìƒˆë¡œìš´ ìˆ˜ìµ ë“±ë¡</div>
  <div class="card gray" role="button" onclick="showPage('page-excel')">ì›”ë³„ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</div>
</div>

<!-- ì¿ íŒ¡/ë°°ë¯¼ -->
<div class="page" id="page-eats">
  <button class="back-btn" onclick="showPage('page-home')">â† ëŒì•„ê°€ê¸°</button>
  <h2>ğŸ“Š ì¿ íŒ¡ì´ì¸  / ë°°ë¯¼ì»¤ë„¥íŠ¸ ìˆ˜ìµ</h2>
  <input id="eats" type="number" placeholder="ì¿ íŒ¡ì´ì¸  ê¸ˆì•¡ (ì›)">
  <input id="baemin" type="number" placeholder="ë°°ë¯¼ì»¤ë„¥íŠ¸ ê¸ˆì•¡ (ì›)">
  <div style="display:flex;gap:10px;justify-content:center;">
    <button class="card green" id="saveEats">ë“±ë¡</button>
    <button class="card white" id="deleteEats">ì‚­ì œ</button>
  </div>
  <div class="calendar" id="eats-calendar"></div>
  <div class="history" id="eats-history"><h3>ğŸ“œ ë“±ë¡ íˆìŠ¤í† ë¦¬</h3><div id="eatsHistoryList"></div></div>
</div>

<!-- ìƒˆë¡œìš´ ìˆ˜ìµ ë“±ë¡ -->
<div class="page" id="page-register">
  <button class="back-btn" onclick="showPage('page-home')">â† ëŒì•„ê°€ê¸°</button>
  <h2 style="color:#00b894;">âœ¨ ìƒˆë¡œìš´ ìˆ˜ìµ ë“±ë¡</h2>
  <input id="incomeAmount" type="number" placeholder="ê¸ˆì•¡ (ì›) ğŸ’°">
  <input id="incomeReason" type="text" placeholder="ì›ì²œ / ì‚¬ìœ  ğŸ§¾">
  <div class="calendar" id="income-calendar"></div>
  <div style="display:flex;gap:10px;justify-content:center;">
    <button class="card green" id="addIncome">ë“±ë¡</button>
    <button class="card white" id="deleteIncome">ì‚­ì œ</button>
  </div>
  <div class="history" id="income-history"><h3>ğŸ“œ ìˆ˜ìµ ë“±ë¡ íˆìŠ¤í† ë¦¬</h3><div id="historyList"></div></div>
</div>

<!-- ì—‘ì…€ -->
<div class="page" id="page-excel">
  <button class="back-btn" onclick="showPage('page-home')">â† ëŒì•„ê°€ê¸°</button>
  <h2>ğŸ“¥ ì›”ë³„ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</h2>
  <div class="calendar" id="excel-calendar"></div>
  <div class="history" id="excel-history"><h3>ğŸ“œ ì—‘ì…€ ì €ì¥ íˆìŠ¤í† ë¦¬</h3><div id="excelHistoryLog">ì•„ì§ ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div></div>
  <div style="display:flex;gap:10px;justify-content:center;margin-top:15px;flex-wrap:wrap;">
    <button class="card gray" id="downloadExcel" style="flex:1;">ì—‘ì…€ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
    <button class="card white" id="deleteExcel" style="flex:1;">ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”</button>
    <button class="card green" id="deleteSelectedExcel" style="flex:1;">ì„ íƒ ë‚ ì§œ ì‚­ì œ</button>
  </div>
</div>

<footer>ì´ë²ˆ ë‹¬ í•©ê³„ : <span id="monthTotal">0</span>ì› ğŸ’°</footer>

<script>
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.style.display='none');
  document.getElementById(id).style.display='block';
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

let eatsData=[],incomeData=[],excelData=[];

function makeCalendar(id){
  const cal=document.getElementById(id);
  for(let i=1;i<=31;i++){
    const d=document.createElement('div');
    d.classList.add('day');
    d.dataset.daynum=i;
    d.innerHTML=`<div class='date'>${i}</div>`;
    d.onclick=()=>{document.querySelectorAll(`#${id} .day`).forEach(x=>x.classList.remove('selected'));d.classList.add('selected');window[id+'Sel']=d;};
    cal.appendChild(d);
  }
}
makeCalendar("eats-calendar");
makeCalendar("income-calendar");
makeCalendar("excel-calendar");

function refreshCalendars(){
  const combined={};
  eatsData.forEach(e=>{const d=e.day;combined[d]=(combined[d]||[]);combined[d].push(e.amount);});
  incomeData.forEach(e=>{const d=e.day;combined[d]=(combined[d]||[]);combined[d].push(`[ì¶”ê°€] ${e.amount}`);});
  ["eats-calendar","income-calendar","excel-calendar"].forEach(id=>{
    document.querySelectorAll(`#${id} .day`).forEach(c=>{
      const day=c.dataset.daynum;
      if(combined[day]){
        const arr=combined[day];
        let html=`<div class='date'>${day}</div><div class='income'>`;
        html+=arr.map(v=>{
          if(typeof v==="string") return `<span class='added'>${v.replace(/\d+/,m=>Number(m).toLocaleString())}ì›</span>`;
          else return `${v.toLocaleString()}ì›`;
        }).join("<br>");
        html+="</div>";
        c.innerHTML=html;
      } else c.innerHTML=`<div class='date'>${day}</div>`;
    });
  });
  const total=Object.values(combined).flat().map(v=>parseInt(String(v).replace(/\D/g,"")||0)).reduce((a,b)=>a+b,0);
  document.getElementById("monthTotal").innerText=total.toLocaleString();
  excelData=[];
  for(let k in combined){
    combined[k].forEach(v=>{
      let val=parseInt(String(v).replace(/\D/g,""));
      excelData.push({ë‚ ì§œ:`10ì›” ${k}ì¼`,ê¸ˆì•¡:val});
    });
  }
  document.getElementById("excelHistoryLog").innerText=`ğŸ’¾ ì´ ${excelData.length}ê±´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`;
}

// âœ… ë“±ë¡
document.getElementById("saveEats").onclick=()=>{
  const target=window["eats-calendarSel"];
  if(!target){alert("ğŸ“… ë‚ ì§œë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš” !");return;}
  const day=target.dataset.daynum;
  if(eatsData.some(e=>e.day==day)){alert("âš ï¸ ì´ë¯¸ ë“±ë¡ëœ ë‚ ì§œì…ë‹ˆë‹¤.");return;}
  const eats=document.getElementById("eats").value||0;
  const bae=document.getElementById("baemin").value||0;
  const total=Number(eats)+Number(bae);
  eatsData.push({day,amount:total});
  const item=document.createElement("div");
  item.classList.add("history-item");
  item.dataset.day=day;
  item.innerHTML=`ğŸ“… ${day}ì¼ | [ì¿ íŒ¡ì´ì¸ ] ${Number(eats).toLocaleString()}ì› [ë°°ë¯¼ì»¤ë„¥íŠ¸] ${Number(bae).toLocaleString()}ì› [í•©ê³„] ${total.toLocaleString()}ì›`;
  document.getElementById("eatsHistoryList").prepend(item);
  refreshCalendars();
  alert("âœ… ë“±ë¡ ì™„ë£Œ!");
};

// âœ… ì‚­ì œ
document.getElementById("deleteEats").onclick=()=>{
  const target=window["eats-calendarSel"];
  if(!target){alert("ğŸ—“ï¸ ì‚­ì œí•  ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš” !");return;}
  const day=target.dataset.daynum;
  eatsData=eatsData.filter(e=>e.day!=day);
  document.querySelectorAll(`#eatsHistoryList .history-item`).forEach(i=>{if(i.dataset.day==day)i.remove();});
  refreshCalendars();
  alert("ğŸ§¹ ì‚­ì œ ì™„ë£Œ!");
};

// âœ… ìˆ˜ìµ ì¶”ê°€
document.getElementById("addIncome").onclick=()=>{
  const target=window["income-calendarSel"];
  if(!target){alert("ğŸ“… ë‚ ì§œë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.");return;}
  const day=target.dataset.daynum;
  const amount=Number(document.getElementById("incomeAmount").value||0);
  const reason=document.getElementById("incomeReason").value||"";
  if(!amount||!reason){alert("ğŸ’¬ ê¸ˆì•¡ê³¼ ì‚¬ìœ ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");return;}
  incomeData.push({day,amount,reason});
  const item=document.createElement("div");
  item.classList.add("history-item");item.dataset.day=day;
  item.innerText=`ğŸ“… ${day}ì¼ | ${amount.toLocaleString()}ì› (${reason})`;
  document.getElementById("historyList").prepend(item);
  refreshCalendars();
  alert("âœ… ì¶”ê°€ ì™„ë£Œ!");
};

// âœ… ìˆ˜ìµ ì‚­ì œ
document.getElementById("deleteIncome").onclick=()=>{
  const target=window["income-calendarSel"];
  if(!target){alert("ğŸ—“ï¸ ì‚­ì œí•  ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš” !");return;}
  const day=target.dataset.daynum;
  incomeData=incomeData.filter(e=>e.day!=day);
  document.querySelectorAll(`#historyList .history-item`).forEach(i=>{if(i.dataset.day==day)i.remove();});
  refreshCalendars();
  alert("ğŸ§¹ ì‚­ì œ ì™„ë£Œ!");
};

// âœ… ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (ì›”ë³„ í•˜ë‚˜ë§Œ)
document.getElementById("downloadExcel").onclick=()=>{
  if(excelData.length===0){alert("âš ï¸ ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");return;}
  const now=new Date();
  const y=now.getFullYear();
  const m=String(now.getMonth()+1).padStart(2,'0');
  const fileName=`${y}.${m}.xlsx`;
  const ws=XLSX.utils.json_to_sheet(excelData);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,`${y}ë…„ ${m}ì›”`);
  XLSX.writeFile(wb,fileName);
  alert(`ğŸ’¾ ${fileName} íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`);
};

// âœ… ì„ íƒ ë‚ ì§œ ì—‘ì…€ ì‚­ì œ
document.getElementById("deleteSelectedExcel").onclick=()=>{
  const target=window["excel-calendarSel"];
  if(!target){alert("ğŸ—“ï¸ ì‚­ì œí•  ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš” !");return;}
  const day=target.dataset.daynum;
  eatsData=eatsData.filter(e=>e.day!=day);
  incomeData=incomeData.filter(e=>e.day!=day);
  refreshCalendars();
  alert(`ğŸ§¹ ${day}ì¼ ìˆ˜ìµì´ ì—‘ì…€ ë°ì´í„°ì—ì„œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!`);
};

// âœ… ì „ì²´ ì´ˆê¸°í™”
document.getElementById("deleteExcel").onclick=()=>{
  eatsData=[];incomeData=[];excelData=[];
  refreshCalendars();
  document.getElementById("excelHistoryLog").innerText="âŒ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.";
  alert("ğŸ§¼ ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!");
};
</script>

</body>
</html>
